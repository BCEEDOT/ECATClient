<mat-sidenav-container fullscreen>
  <mat-sidenav #sidenav mode="side" color="primary" opened="true" style="width:257px;border-right:1px solid #ccc">
    <div flex class="mat-content ">
      <mat-nav-list>
        <td-expansion-panel *ngIf="readOnly" label="Unassigned Students" [expand]="isUnassignedPanelExpanded">
          <div fxLayout="column" id="unassigned" style="min-height: 50px;">
            <p [id]="unassignedStudent.studentId" [myHighlight]="unassignedStudent.highlighted" (mouseover)="hovered = unassignedStudent.studentId"
              (mouseout)="hovered = null" class="push-none pad-sm mat-caption" style="padding-left: 16px;" *ngFor="let unassignedStudent of unassignedStudents">
              {{unassignedStudent.rankName}}
            </p>
          </div>
        </td-expansion-panel>
        <td-expansion-panel *ngIf="!readOnly" label="Unassigned Students" [expand]="isUnassignedPanelExpanded">
          <div fxLayout="column" id="unassigned" style="min-height: 50px;" [dragula]='"bag-one"' [dragulaModel]='unassignedStudents'>
            <p [id]="unassignedStudent.studentId" [myHighlight]="unassignedStudent.highlighted" [ngClass]="{'selected': hovered === unassignedStudent.studentId}"
              (mouseover)="hovered = unassignedStudent.studentId" (mouseout)="hovered = null" class="push-none pad-sm mat-caption"
              style="padding-left: 16px;" *ngFor="let unassignedStudent of unassignedStudents" (click)="studentClick(unassignedStudent)">

              {{unassignedStudent.rankName}}
            </p>
          </div>
        </td-expansion-panel>
        <td-expansion-panel label="Roster Changes" [disabled]="changes.length === 0">

          <div *ngFor="let change of changes" fxLayout="row" fxLayoutAlign="start center">
            <div fxFlexOffset="5%"></div>
            <p class="push-none pad-xs mat-caption">
              {{change.changeDescription}}
            </p>
            <div fxFlex></div>
            <a mat-icon-button matTooltip="Click to Undo Change" (click)="undoChange(change)">
              <mat-icon>close</mat-icon>
            </a>
          </div>

        </td-expansion-panel>
      </mat-nav-list>
    </div>
  </mat-sidenav>
  <!-- Search/save/back/reset/expand all bar -->
  <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="20px" class="pad-right-sm pad-left-sm">
    <button type="button" mat-raised-button color="primary" [routerLink]="['../..']">Back</button>
    <td-search-box [showUnderline]="true" (search)="search($event)" (clear)="clear($event)" backIcon="arrow_back" placeholder="Search here"
      [alwaysVisible]="false" flex></td-search-box>
    
    
    <mat-slide-toggle class="example-margin" [(ngModel)]="allExpanded" (change)="expandOrCollapseAll()">
      {{(allExpanded) ? 'Collapse' : 'Expand'}} All
    </mat-slide-toggle>
    <button (click)="reset(false)" type="button" mat-stroked-button color="primary">Reset</button>
    <button [ngClass]="canSaveFlag ? '' : 'can-save'" [disabled]="!changesToSave()" (click)="save()" type="button" mat-raised-button
      color="primary">Save</button>
  </div>

  <div fxLayout="row wrap" fxLayoutAlign="space-around start" class="pad-bottom-xl">
    <div fxFlex="25%" *ngFor="let workGroup of workGroups">
      <!-- Workgroup cards if the group published  -->
      <mat-card *ngIf="readOnly">
        <td-expansion-panel [expand]="workGroup.isExpanded">
          <ng-template td-expansion-panel-label>
            <mat-icon>lock_outline</mat-icon>
            <span>{{workGroup.defaultName}} - ({{workGroup.groupMembers.length}})</span>
          </ng-template>
          <td-expansion-summary>
            <div fxLayout="row" class="bgc-grey-50 pad-left-md pad-right-md pad-top-sm">
              <span fxFlex class="pad-top-sm">{{(workGroup.customName) ? workGroup.customName : 'N/A'}}</span>
              <a fxFlexAlign="end center" mat-icon-button matTooltip="Click to edit Flight" (click)="editGroup(workGroup)">
                <mat-icon>edit</mat-icon>
              </a>
            </div>
          </td-expansion-summary>
          <mat-divider></mat-divider>
          <mat-card-content>
            <div style="min-height: 50px" [id]="workGroup.workGroupId">
              <p *ngFor="let groupMember of workGroup.groupMembers trackBy:groupMember?.studentId" [id]="groupMember.studentId" [myHighlight]="groupMember.highlighted"
                (mouseover)="hovered = groupMember.studentId" (mouseout)="hovered = null" class="mat-caption push-none pad-xs">
                {{groupMember.rankName}}
              </p>
            </div>
          </mat-card-content>
        </td-expansion-panel>
      </mat-card>

      <!-- Workgroup cards if the group is not published....Then checks if workgroup is open/created  -->
      <mat-card *ngIf="!readOnly">
        <td-expansion-panel [expand]="workGroup.isExpanded">
          <ng-template td-expansion-panel-label>
            <mat-icon *ngIf="!workGroup.canEdit">lock_outline</mat-icon>
            <span>{{workGroup.defaultName}} - ({{workGroup.groupMembers.length}})</span>
          </ng-template>
          <td-expansion-summary>
            <div fxLayout="row" class="bgc-grey-50 pad-left-md pad-right-md pad-top-sm">
              <span fxFlex class="pad-top-sm">{{(workGroup.customName) ? workGroup.customName : 'N/A'}}</span>
              <div class="pull-top-sm">
                <a fxFlexAlign="end center" mat-icon-button matTooltip="Click to edit Flight" (click)="editGroup(workGroup)">
                  <mat-icon>edit</mat-icon>
                </a>
              </div>
            </div>
          </td-expansion-summary>
          <mat-divider></mat-divider>
          <mat-card-content *ngIf="!workGroup.canEdit">
            <div style="min-height: 50px" [id]="workGroup.workGroupId">
              <p *ngFor="let groupMember of workGroup.groupMembers trackBy:groupMember?.studentId" [id]="groupMember.studentId" [myHighlight]="groupMember.highlighted"
                (mouseover)="hovered = groupMember.studentId" (mouseout)="hovered = null" class="mat-caption push-none pad-xs">
                {{groupMember.rankName}}
              </p>
            </div>
          </mat-card-content>
          <mat-card-content *ngIf="workGroup.canEdit">
            <div style="min-height: 50px" [id]="workGroup.workGroupId" [dragula]='"bag-one"' [dragulaModel]='workGroup.groupMembers'>
              <p *ngFor="let groupMember of workGroup.groupMembers trackBy:groupMember?.studentId" [id]="groupMember.studentId" [myHighlight]="groupMember.highlighted"
                [ngClass]="{'selected': hovered === groupMember.studentId}" (mouseover)="hovered = groupMember.studentId" (mouseout)="hovered = null"
                class="mat-caption push-none pad-xs" (click)="studentClick(groupMember)">
                {{groupMember.rankName}}
              </p>
            </div>
          </mat-card-content>
        </td-expansion-panel>
      </mat-card>
      <button *ngIf="!readOnly" mat-fab (click)="addGroup()" color="primary" class="mat-fab-bottom-right fixed fab-pad" matTooltip="Add Flight"
        matTooltipPosition="left">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>
  <button (click)="getChanges()">Changes</button>
</mat-sidenav-container>

